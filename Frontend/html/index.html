<!DOCTYPE html>
<html>
    <head>
        <title>Information Bubble Simulator</title>
        <link rel="stylesheet" href="../css/index.css">
    </head>
    <body>
        <h1 class="title">Information Bubble Simulator</h1>
        <div class="main-content">
            <div class="main-content-grid">
                <!--First column-->
                <canvas id="simulation-canvas" width="750" height="750"></canvas>
                <!--Second column-->
                <div class="second-column">
                    <form action="/action_page.php">
                        <div class="input-group">
                            <label for="agent-num">Liczba agentów</label>
                            <input type="number" id="agent-num" value="100"><br>
                            <label for="step-num">Liczba kroków</label>
                            <input type="number" id="step-num" value="100"><br>
                        </div>
                        <p>Przyjmowanie nowych informacji</p>
                        <div class="input-group">
                            <label for="info-latitude">Tolerancja</label>
                            <input type="number" id="info-latitude" value="0.5" min="0" max="1" step="0.1"><br>
                            <label for="info-sharpness">Ostrość</label>
                            <input type="number" id="info-sharpness" value="5"><br>
                        </div>
                        <p>Przyjmowanie nowych przyjaciół</p>
                        <div class="input-group">
                            <label for="friend-latitude">Tolerancja</label>
                            <input type="number" id="friend-latitude" value="0.5" min="0" max="1" step="0.1"><br>
                            <label for="friend-sharpness">Ostrość</label>
                            <input type="number" id="friend-sharpness" value="5"><br>
                        </div>
                        <p>Sposób wymiany informacji</p>
                        <div class="input-group">
                            <input type="radio" name="info-sharing-mode" value="one-to-one" id="one-to-one">
                            <label for="one-to-one">Jeden do jednego</label><br>
                            <input type="radio" name="info-sharing-mode" value="one-to-many" id="one-to-many">
                            <label for="one-to-many">Jeden do wielu</label><br>
                            <input type="radio" name="info-sharing-mode" value="subgroups" id="subgroups">
                            <label for="subgroups">W podgrupach</label><br>
                        </div>
                        <div style="margin-bottom: 5px;">
                            <button type="button">Zapisz parametry</button>
                            <button type="button">Wczytaj parametry</button>
                        </div>
                        <div style="position: relative; text-align: center;">
                            <button type="button" onclick="startSimulation()" style="margin:auto">Rozpocznij symulację</button>
                        </div>
                    </form>
                    <div style="position: relative; margin-top: 10px;">
                        Połączenie: <div id="connection-square"></div>
                    </div>
                    <div class="slidecontainer" style="align-self: center; width: 100%;">
                        <p>Krok symulacji: <span id="current-step">100</span></p>
                        <input type="range" min="1" max="100" value="50" id="step-slider" oninput="updateCurrentStep()"><br>
                    </div>
                </div>                        
            </div>
        </div>
    </body>
    <footer style="text-align: center; margin-top: 20px; color: gray; font-size: x-small;">
        Autorzy: <br>
        Paweł Frąckiewicz,
        Jan Janiszewski,
        Ignacy Sujecki <br>
        Politechnika Warszawska, 2022 <br>
    </footer>
    <script src="../javascript/index.js"></script>
    <script src="https://cdn.socket.io/4.2.0/socket.io.min.js" integrity="sha384-PiBR5S00EtOj2Lto9Uu81cmoyZqR57XcOna1oAuVuIEjzj0wpqDVfD0JA9eXlRsj" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">  
        const socket = io("http://127.0.0.1:5000");

        socket.on("connect", () => {
            console.log("connected");
            document.getElementById("connection-square").style.backgroundColor = "green";
        });

        socket.on("disconnect", () => {
            console.log("disconnected");
            document.getElementById("connection-square").style.backgroundColor = "red";
        });

        socket.on("simulation_finished", (data) => {
            console.log(data);
            clearCanvas();
            for(const u in data){
                addUser(data[u][0], data[u][1]);
            }
        });

        function startSimulation()
        {
            let numUsers = document.getElementById("agent-num").value;
            socket.emit("start_simulation", numUsers);
            console.log("Event sent");
        }
    </script>
</html>
